<!-- report.component.html -->
<app-topbar (toggleSidebar)="toggleSidebar()"></app-topbar>
<app-sidebar [(isOpen)]="isSidebarOpen"></app-sidebar>

<div class="report-page">
  <div class="report-header">
    <h1>Reports</h1>
    <p>View and manage your reports</p>
  </div>

  <div class="report-list" *ngIf="!showAttendanceReport">
    <div *ngFor="let report of reports" class="report-card">
      <div class="report-title">{{ report.title }}</div>
      <div class="report-date">{{ report.date }}</div>
      <div class="report-status" [ngClass]="report.status.toLowerCase()">
        {{ report.status }}
      </div>
      <button class="view-report-btn" (click)="viewReport(report)">
        View Report
      </button>
    </div>
  </div>

  <div *ngIf="showAttendanceReport" class="attendance-report">
    <h2>Attendance Report Generator</h2>

    <div class="report-controls">
      <div class="control-group">
        <label>Select Employee</label>
        <select [(ngModel)]="selectedEmployee" (ngModelChange)="onSelectionChange()">
          <!-- Show employee codes with names -->
          <option *ngFor="let employee of employeeCodes" [value]="employee.Value">
            {{ employee.Text }} ({{ employee.Value }})
          </option>
        </select>
        
        
      </div>

      <div class="control-group">
        <label>Select Month</label>
        <select [(ngModel)]="selectedMonth" (ngModelChange)="onSelectionChange()">
          <option *ngFor="let month of months" [value]="month.value">
            {{ month.name }}
          </option>
        </select>
      </div>

      <div class="control-group">
        <label>Select Year</label>
        <select [(ngModel)]="selectedYear" (ngModelChange)="onSelectionChange()">
          <option *ngFor="let year of years" [value]="year">{{ year }}</option>
        </select>
      </div>
    </div>

    <div class="status-messages">
      <div *ngIf="isLoading" class="loading-message">
        Loading attendance data...
      </div>
      <div *ngIf="error" class="error-message">
        {{ error }}
      </div>
    </div>

    <div class="calendar">
      <div class="calendar-header">
        <div *ngFor="let day of weekDays" class="day-header">{{ day }}</div>
      </div>
      
      <div class="calendar-body">
        <div
          *ngFor="let day of generateCalendarDays(selectedYear, selectedMonth)"
          class="calendar-cell"
          [ngClass]="{
            'weekend': day.isWeekend,
            'other-month': !day.isCurrentMonth,
            'present': day.attendance?.status === 'Present',
            'absent': day.isCurrentMonth && !day.attendance
          }"
        >
          <div class="date">{{ day.date?.getDate() }}</div>
          <div class="attendance-info" *ngIf="day.attendance">
            <div class="hours">{{ day.attendance.hours_worked.toFixed(2) }} hrs</div>
            <div class="time">
              {{ day.attendance.check_in.slice(0, 5) }} - 
              {{ day.attendance.check_out ? day.attendance.check_out.slice(0, 5) : '0.00' }}
            </div>
            <div class="status" [ngClass]="day.attendance.arrival_status.toLowerCase().replace(' ', '-')">
              {{ day.attendance.arrival_status }}
            </div>
          </div>
          <div class="absent-marker" *ngIf="day.isCurrentMonth && !day.attendance">
            Absent
          </div>
        </div>
      </div>

      <div class="attendance-summary" *ngIf="attendanceData">
        <div class="total-hours">
          Total Hours: {{ attendanceData.summary.total_hours_worked.toFixed(2) }}
        </div>
      </div>
    </div>

    <button class="back-btn" (click)="backToReports()">Back to Reports</button>
  </div>

</div>