<div class="daily-attendance-page">
<app-topbar (toggleSidebar)="toggleSidebar()"></app-topbar>

<div class="main-content">
<app-sidebar [(isOpen)]="isSidebarOpen"></app-sidebar>

<div class="attendance-report">
  <h2>Attendance Report Generator</h2>

  <div class="report-controls">
    <div class="control-group">
      <label>Select Employee</label>
      <select [(ngModel)]="selectedEmployee" (ngModelChange)="onSelectionChange()">
        <option *ngFor="let employee of employeeCodes" [value]="employee.Value">
          {{ employee.Text }} 
        </option>
      </select>
    </div>

    <div class="control-group">
      <label>Select Month</label>
      <select [(ngModel)]="selectedMonth" (ngModelChange)="onSelectionChange()">
        <option *ngFor="let month of months" [value]="month.value">
          {{ month.name }}
        </option>
      </select>
    </div>

    <div class="control-group">
      <label>Select Year</label>
      <select [(ngModel)]="selectedYear" (ngModelChange)="onSelectionChange()">
        <option *ngFor="let year of years" [value]="year">{{ year }}</option>
      </select>
    </div>
  </div>

  <div class="status-messages">
    <div *ngIf="isLoading" class="loading-message">
      Loading attendance data...
    </div>
    <div *ngIf="error" class="error-message">
      {{ error }}
    </div>
  </div>

  <div class="calendar">
    <div class="calendar-header">
      <div *ngFor="let day of weekDays" class="day-header">{{ day }}</div>
    </div>
    
    <div class="calendar-body">
      <div
        *ngFor="let day of generateCalendarDays(selectedYear, selectedMonth)"
        class="calendar-cell"
        [ngClass]="{
          'weekend': day.isWeekend,
          'other-month': !day.isCurrentMonth,
          'present': day.attendance?.status === 'Present',
          'half-day': day.attendance?.status === 'Half Day',
          'absent': day.isCurrentMonth && !day.attendance
        }"
      >
        <div class="date">{{ day.date?.getDate() }}</div>
        <div class="attendance-info" *ngIf="day.attendance">
          <div class="hours">{{ day.attendance.hours_worked.toFixed(2) }} hrs</div>
          <div class="overtime" *ngIf="day.attendance.overtime_hours > 0">
            +{{ day.attendance.overtime_hours.toFixed(2) }} OT
          </div>
          <div class="time">
            {{ day.attendance.check_in.slice(0, 5) }} - 
            {{ day.attendance.check_out ? day.attendance.check_out.slice(0, 5) : '--:--' }}
          </div>
          <div class="status"
          [ngClass]="day.attendance.arrival_status.toLowerCase().replace(' ', '-')"
          *ngIf="day.attendance.arrival_status.toLowerCase() !== 'on time'">
          {{ day.attendance.arrival_status }}
     </div>
     <div class="status on-time" *ngIf="day.attendance.arrival_status.toLowerCase() === 'on time'">
        {{ day.attendance.arrival_status }}
     </div>
        </div>
        
        <div class="absent-marker" *ngIf="day.isCurrentMonth && !day.attendance">
          Absent
        </div>
      </div>
    </div>

    <div class="attendance-summary" *ngIf="attendanceData">
      <div class="total-hours">
        Total Hours: {{ attendanceData.summary.total_hours_worked.toFixed(2) }}
      </div>
      <div class="total-overtime">
        Total Overtime: {{ attendanceData.summary.total_overtime_hours.toFixed(2) }}
      </div>
    </div>
  </div>

  <!-- <button class="back-btn" (click)="backToReports()">Back to Reports</button> -->
</div>
</div>
</div>